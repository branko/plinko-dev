{"version":3,"sources":["../src/server_engine.js"],"names":["CANVAS_WIDTH","CANVAS_HEIGHT","path","require","app","server","Server","io","localtunnel","engine","Engine","create","World","add","world","bodies","run","setInterval","update","console","log","map","id","body","label","x","Math","floor","position","y","linearVelocity","velocity","filter","b","emit","Events","on","event","pairs","i","length","pair","bodyA","render","fillStyle","bodyB","tunnel","subdomain","err","url","get","req","res","__dirname","sendFile","resolve","socket","message","coords","chip","listen"],"mappings":";;AASA;;;;AACA;;;;AACA;;;;AAXA,IAAIA,eAAe,GAAnB;AACA,IAAIC,gBAAgB,GAApB;;AAEA,IAAIC,OAAOC,QAAQ,MAAR,CAAX;AACA,IAAIC,MAAMD,QAAQ,SAAR,GAAV;AACA,IAAIE,SAASF,QAAQ,MAAR,EAAgBG,MAAhB,CAAuBF,GAAvB,CAAb;AACA,IAAIG,KAAKJ,QAAQ,WAAR,EAAqBE,MAArB,CAAT;AACA,IAAIG,cAAcL,QAAQ,aAAR,CAAlB;;AAMA;AACA,IAAIM,SAASC,iBAAOC,MAAP,EAAb;;AAEAC,gBAAMC,GAAN,CAAUJ,OAAOK,KAAjB,EAAwBC,uBAAxB;;AAEA;AACA,IAAIC,MAAM,SAANA,GAAM,GAAW;AACnB,SAAOC,YAAY,YAAW;AAC1BP,qBAAOQ,MAAP,CAAcT,MAAd,EAAsB,OAAO,EAA7B;AACH,GAFM,EAEJ,OAAO,EAFH,CAAP;AAGD,CAJD;;AAMAO;;AAEAG,QAAQC,GAAR,CAAY,gBAAZ;;AAEAH,YAAY,YAAM;;AAEhB,MAAIF,SAASN,OAAOK,KAAP,CAAaC,MAAb,CAAoBM,GAApB,CAAwB,gBAAQ;AAC3C,WAAO;AACLC,UAAIC,KAAKD,EADJ;AAELE,aAAOD,KAAKC,KAFP;AAGLC,SAAGC,KAAKC,KAAL,CAAWJ,KAAKK,QAAL,CAAcH,CAAzB,CAHE;AAILI,SAAGH,KAAKC,KAAL,CAAWJ,KAAKK,QAAL,CAAcC,CAAzB,CAJE;AAKLC,sBAAgBP,KAAKQ;AALhB,KAAP;AAOD,GARY,EAQVC,MARU,CAQH;AAAA,WAAKC,EAAET,KAAF,KAAY,MAAjB;AAAA,GARG,CAAb;;AAUAjB,KAAG2B,IAAH,CAAQ,UAAR,EAAoBnB,MAApB;AAED,CAdD,EAcG,OAAK,EAdR;;AAiBAoB,iBAAOC,EAAP,CAAU3B,MAAV,EAAkB,gBAAlB,EAAoC,UAAS4B,KAAT,EAAgB;AAChD,MAAIC,QAAQD,MAAMC,KAAlB;;AAEA,OAAK,IAAIC,IAAI,CAAb,EAAgBA,IAAID,MAAME,MAA1B,EAAkCD,GAAlC,EAAuC;AACnC,QAAIE,OAAOH,MAAMC,CAAN,CAAX;;AAEA,QAAIE,KAAKC,KAAL,CAAWlB,KAAX,KAAqB,KAAzB,EAAgC;AAC9BiB,WAAKC,KAAL,CAAWC,MAAX,CAAkBC,SAAlB,GAA8BH,KAAKI,KAAL,CAAWF,MAAX,CAAkBC,SAAhD;AACD,KAFD,MAEO,IAAIH,KAAKI,KAAL,CAAWrB,KAAX,KAAqB,KAAzB,EAAgC;AACrCiB,WAAKI,KAAL,CAAWF,MAAX,CAAkBC,SAAlB,GAA8BH,KAAKC,KAAL,CAAWC,MAAX,CAAkBC,SAAhD;AACD;AACJ;AACJ,CAZD;;AAeA,IAAIE,SAAStC,YAAY,IAAZ,EAAkB,EAACuC,WAAW,qBAAZ,EAAlB,EAAqD,UAACC,GAAD,EAAMF,MAAN,EAAiB;AACjF3B,UAAQC,GAAR,CAAY0B,OAAOG,GAAnB;AACD,CAFY,CAAb;;AAIA7C,IAAI8C,GAAJ,CAAQ,GAAR,EAAa,UAACC,GAAD,EAAMC,GAAN,EAAc;AACzBjC,UAAQC,GAAR,CAAYiC,YAAY,qBAAxB;AACAD,MAAIE,QAAJ,CAAapD,KAAKqD,OAAL,CAAaF,YAAY,qBAAzB,CAAb;AACD,CAHD;;AAKAjD,IAAI8C,GAAJ,CAAQ,UAAR,EAAoB,UAACC,GAAD,EAAMC,GAAN,EAAc;AAChCA,MAAIE,QAAJ,CAAapD,KAAKqD,OAAL,CAAaF,YAAY,kBAAzB,CAAb;AACD,CAFD;;AAKA9C,GAAG6B,EAAH,CAAM,YAAN,EAAoB,UAACoB,MAAD,EAAY;AAC9BA,SAAOtB,IAAP,CAAY,wBAAZ,EAAsC,EAAEuB,SAAS,cAAX,EAAtC;;AAEAD,SAAOpB,EAAP,CAAU,UAAV,EAAuB,UAASsB,MAAT,EAAiB;AACtCvC,YAAQC,GAAR,CAAY,6BAAZ;AACA,QAAIuC,OAAO,oBAAaD,OAAOjC,CAApB,EAAuBiC,OAAO7B,CAA9B,CAAX;AACAjB,oBAAMC,GAAN,CAAUJ,OAAOK,KAAjB,EAAwB6C,KAAKpC,IAA7B;AACD,GAJD;;AAMA;AACA;AACA;AACD,CAZD;;AAcAuB,OAAOV,EAAP,CAAU,OAAV,EAAmB,YAAW;AAC5BjB,UAAQC,GAAR,CAAY,kBAAZ;AACD,CAFD;;AAIAf,OAAOuD,MAAP,CAAc,IAAd","file":"server_engine.js","sourcesContent":["var CANVAS_WIDTH = 682\nvar CANVAS_HEIGHT = 660\n\nvar path = require('path');\nlet app = require('express')()\nlet server = require('http').Server(app)\nlet io = require('socket.io')(server)\nlet localtunnel = require('localtunnel')\n\nimport bodies from './generateWorld';\nimport generateChip from './bodies/Chip';\nimport { Engine, World, Bodies, Body, Events } from 'matter-js';\n\n// create an engine\nvar engine = Engine.create();\n\nWorld.add(engine.world, bodies)\n\n// run the engine\nvar run = function() {\n  return setInterval(function() {\n      Engine.update(engine, 1000 / 60);\n  }, 1000 / 60);\n}\n\nrun()\n\nconsole.log('running engine')\n\nsetInterval(() => {\n\n  var bodies = engine.world.bodies.map(body => {\n    return {\n      id: body.id,\n      label: body.label,\n      x: Math.floor(body.position.x),\n      y: Math.floor(body.position.y),\n      linearVelocity: body.velocity\n    }\n  }).filter(b => b.label === 'chip')\n\n  io.emit('snapshot', bodies)\n\n}, 1000/30)\n\n\nEvents.on(engine, 'collisionStart', function(event) {\n    var pairs = event.pairs;\n\n    for (var i = 0; i < pairs.length; i++) {\n        var pair = pairs[i];\n\n        if (pair.bodyA.label === 'peg') {\n          pair.bodyA.render.fillStyle = pair.bodyB.render.fillStyle;\n        } else if (pair.bodyB.label === 'peg') {\n          pair.bodyB.render.fillStyle = pair.bodyA.render.fillStyle;\n        }\n    }\n});\n\n\nlet tunnel = localtunnel(3000, {subdomain: 'radioactive-kittens'},(err, tunnel) => {\n  console.log(tunnel.url)\n})\n\napp.get('/', (req, res) => {\n  console.log(__dirname + '/../dist/index.html')\n  res.sendFile(path.resolve(__dirname + '/../dist/index.html'));\n})\n\napp.get('/main.js', (req, res) => {\n  res.sendFile(path.resolve(__dirname + '/../dist/main.js'))\n})\n\n\nio.on('connection', (socket) => {\n  socket.emit('connection established', { message: 'you made it!' })\n\n  socket.on('new chip' , function(coords) {\n    console.log('new chip received by server')\n    let chip = generateChip(coords.x, coords.y)\n    World.add(engine.world, chip.body)\n  })\n\n  // socket.on('pingRequest', () => {\n  //   socket.emit('pongResponse', 'pong')\n  // })\n});\n\ntunnel.on('close', function() {\n  console.log('tunnel closed :(')\n});\n\nserver.listen(3000)\n"]}