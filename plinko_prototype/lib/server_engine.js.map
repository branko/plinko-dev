{"version":3,"sources":["../src/server_engine.js"],"names":["CANVAS_WIDTH","CANVAS_HEIGHT","path","require","app","server","Server","io","localtunnel","engine","Engine","create","World","add","world","bodies","run","setInterval","update","map","id","body","label","x","Math","floor","position","y","filter","b","emit","Events","on","event","pairs","i","length","pair","bodyA","render","fillStyle","bodyB","tunnel","subdomain","err","console","log","url","get","req","res","__dirname","sendFile","resolve","socket","message","coords","chip","listen"],"mappings":"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","file":"server_engine.js","sourcesContent":["var CANVAS_WIDTH = 682\nvar CANVAS_HEIGHT = 660\n\n\nvar path = require('path');\nlet app = require('express')()\nlet server = require('http').Server(app)\nlet io = require('socket.io')(server)\nlet localtunnel = require('localtunnel')\n\nimport bodies from './generateWorld';\nimport generateChip from './bodies/Chip';\nimport { Engine, World, Bodies, Body, Events } from 'matter-js';\n\n// create an engine\nvar engine = Engine.create();\n\nWorld.add(engine.world, bodies)\n\n// run the engine\nvar run = function() {\n  return setInterval(function() {\n      Engine.update(engine, 1000 / 60);\n  }, 1000 / 60);\n}\n\nrun()\n\n\nsetInterval(() => {\n\n  var bodies = engine.world.bodies.map(body => {\n    return {\n      id: body.id,\n      label: body.label,\n      x: Math.floor(body.position.x),\n      y: Math.floor(body.position.y),\n    }\n  }).filter(b => b.label === 'chip')\n  \n  io.emit('snapshot', bodies)\n\n}, 1000)\n\n\nEvents.on(engine, 'collisionStart', function(event) {\n    var pairs = event.pairs;\n\n    for (var i = 0; i < pairs.length; i++) {\n        var pair = pairs[i];\n\n        if (pair.bodyA.label === 'peg') {\n          pair.bodyA.render.fillStyle = pair.bodyB.render.fillStyle;\n        } else if (pair.bodyB.label === 'peg') {\n          pair.bodyB.render.fillStyle = pair.bodyA.render.fillStyle;\n        }\n    }\n});\n\n\nlet tunnel = localtunnel(3000, {subdomain: 'radioactive-kittens'},(err, tunnel) => {\n  console.log(tunnel.url)\n})\n\napp.get('/', (req, res) => {\n  console.log(__dirname + '/../dist/index.html')\n  res.sendFile(path.resolve(__dirname + '/../dist/index.html'));\n})\n\napp.get('/main.js', (req, res) => {\n  res.sendFile(path.resolve(__dirname + '/../dist/main.js'))\n})\n\n\nio.on('connection', (socket) => {\n  socket.emit('connection established', {message: 'you made it!'})\n\n  socket.on('new chip' , function(coords) {\n    let chip = generateChip(coords.x, coords.y)\n    World.add(engine.world, chip)\n  })\n\n  socket.on('pingRequest', () => {\n    socket.emit('pongResponse', 'pong')\n  })\n});\n\ntunnel.on('close', function() {\n  console.log('tunnel closed :(')\n});\n\nserver.listen(3000)\n"]}